<!DOCTYPE html>
<html>
<head>
<title>Smart Signage Player</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  background: black;
  overflow: hidden;
}

#video, #image, #pdf {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  object-fit: contain;
  background: black;
  display: none;
}
</style>
</head>

<body>

<video id="video" autoplay muted></video>
<img id="image">
<iframe id="pdf"></iframe>

<script>
const DEVICE_ID = "SCREEN_001";
const SERVER = "https://coelanaglyphic-unscornfully-celsa.ngrok-free.dev";
const WS_URL = "wss://coelanaglyphic-unscornfully-celsa.ngrok-free.dev/ws/" + DEVICE_ID;

let playlist = [];
let index = 0;

const video = document.getElementById("video");
const image = document.getElementById("image");
const pdf = document.getElementById("pdf");

function hideAll() {
  video.style.display = "none";
  image.style.display = "none";
  pdf.style.display = "none";
}

function playNext() {
  if (playlist.length === 0) return;

  hideAll();

  const item = playlist[index];
  const url = SERVER + item.url;

  console.log("Playing:", item.type, url);

  if (item.type === "videos") {
    video.src = url;
    video.style.display = "block";
    video.play();
    video.onended = playNext;
  }

  else if (item.type === "images") {
    image.src = url;
    image.style.display = "block";
    setTimeout(playNext, 8000);
  }

  else if (item.type === "pdfs") {
    pdf.src = url;
    pdf.style.display = "block";
    setTimeout(playNext, 15000);
  }

  index = (index + 1) % playlist.length;
}

const ws = new WebSocket(WS_URL);

ws.onopen = () => {
  console.log("Connected to signage server");
};

ws.onmessage = (event) => {
  playlist = JSON.parse(event.data);
  index = 0;
  playNext();
};

ws.onerror = (err) => {
  console.error("WebSocket error", err);
};
</script>

</body>
</html>
